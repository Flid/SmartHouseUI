#:import WeatherWidget smart_house_ui.WeatherWidget
#:set sidebar_width 64
#:set sidebar_height 417
#:set panel_width 321
#:set panel_height 199
#:set shadow_horizontal 9
#:set shadow_vertical 11
#:set clearance_size 20


<B@Widget>:
    canvas.after:
        Line:
            rectangle: self.x+1,self.y+1,self.width-1,self.height-1
            dash_offset: 5
            dash_length: 3


<Label>:
    font_name: 'static/AleksandraC.ttf'


<MusicProgressBar>:
    value: 0

    dot: dot

    canvas:
        Color:
            rgb: 1, 1, 1

        BorderImage:
            border: (12, 12, 12, 12)
            pos: self.x, self.center_y - 12
            size: self.width, 24
            source: 'atlas://data/images/defaulttheme/progressbar_background'
        BorderImage:
            border: [int(min(self.width * (self.value / float(self.max)) if self.max else 0, 12))] * 4
            pos: self.x, self.center_y - 12
            size: self.width * (self.value / float(self.max)) if self.max else 0, 24
            source: 'static/music/progressbar.png'

    Image:
        id: dot
        source: 'static/music/progress_bar_dot.png'
        size: 14, 14
        pos: self.parent.x -7, self.parent.y + self.parent.height/2 - 7


<Sidebar@RelativeLayout+SidebarWidget>:
    size_hint: None, None
    size: 64, sidebar_height
    pos: 0, (480 - sidebar_height) / 2

    settings_btn: settings_btn
    quit_btn: quit_btn

    canvas:
        Rectangle:
            size: 99, sidebar_height+shadow_vertical
            pos: 0, -shadow_vertical
            source: 'static/sidebar.png'

    Button:
        id: settings_btn
        background_normal: 'static/settings_btn.png'
        background_down: 'static/settings_btn.png'
        size_hint: None, None
        size: 50, 50
        pos: 7, sidebar_height - 50 - 10
        on_press: self.parent.on_btn_settings()

    Button:
        id: quit_btn
        background_normal: 'static/quit_btn.png'
        background_down: 'static/quit_btn.png'
        size_hint: None, None
        size: 50, 50
        pos: 7, 10
        on_press: self.parent.on_btn_quit()

<Panel@FloatLayout>:
    size_hint: None, None
    size: panel_width, panel_height

    canvas:
        Rectangle:
            source: 'static/panel.png'
            size: panel_width+shadow_horizontal, panel_height+shadow_vertical
            pos: self.x, self.y-shadow_vertical


<WeatherPanel@Panel+WeatherWidget>:
    pos: 0, panel_height+clearance_size

    weather_icon: weather_icon
    temp_out: temp_out
    temp_in: temp_in
    humidity_out: humidity_out
    humidity_in: humidity_in
    pressure: pressure
    rain_forecast: rain_forecast

    Image:
        id: weather_icon
        source: 'static/weather/03.png'
        size_hint: 0.5, 0.7
        pos_hint: {'top': 1, 'left': 0}

    FloatLayout:
        size_hint: 0.5, 0.25
        pos_hint: {'x': 0.48, 'top': 0.95}

        Image:
            source: 'static/weather/therm_icon.png'
            size_hint: 0.3, 1
            pos_hint: {'x': 0.35, 'top': 1}

        Label:
            id: temp_out
            text: '--'
            size_hint: 0.35, 1
            pos_hint: {'x': 0, 'top': 1}
            font_size: 40

        Label:
            id: temp_in
            text: '--'
            size_hint: 0.35, 1
            pos_hint: {'right': 1, 'top': 1}
            font_size: 40

    FloatLayout:
        size_hint: 0.5, 0.2
        pos_hint: {'x': 0.48, 'top': 0.7}

        Image:
            source: 'static/weather/humidity_icon.png'
            size_hint: 0.3, 1
            pos_hint: {'x': 0.35, 'top': 1}

        Label:
            id: humidity_out
            text: '--'
            size_hint: 0.35, 1
            pos_hint: {'x': 0, 'top': 1}
            font_size: 30

        Label:
            id: humidity_in
            text: '--'
            size_hint: 0.35, 1
            pos_hint: {'right': 1, 'top': 1}
            font_size: 30

    Label:
        id: pressure
        text: 'Pressure: +0.0%'
        size_hint: 0.5, 0.2
        pos_hint: {'x': 0.48, 'top': 0.5}
        font_size: 20

    Label:
        id: rain_forecast
        text: 'Expecting: -------- (0.00)'
        size_hint: 1, 0.3
        pos_hint: {'x': 0, 'y': 0.05}
        font_size: 20

<MusicPanel@Panel+PlayerWidget>:
    pos: panel_width+clearance_size, panel_height+clearance_size

    play_btn: play_btn
    progress_bar: progress_bar

    FloatLayout:
        size_hint: 1, 0.15
        pos_hint: {'x': 0, 'top': 0.95}

        ImageButton:
            source: 'static/music/shuffle.png'
            size_hint: 0.15, 1
            pos_hint: {'x': 0.2, 'y': 0}

        ImageButton:
            source: 'static/music/repeat.png'
            size_hint: 0.2, 1
            pos_hint: {'x': 0.05, 'y': 0}

        ImageButton:
            source: 'static/music/dropdown.png'
            size_hint: 0.2, 1
            pos_hint: {'x': 0.75, 'y': 0}

    FloatLayout:
        size_hint: 1, 0.25
        pos_hint: {'x': 0, 'top': 0.8}

        Label:
            text: 'Track Name'
            size_hint: 1, 0.55
            pos_hint: {'x': 0, 'y': 0.45}
            font_size: 20

        Label:
            text: 'Track Album'
            size_hint: 1, 0.45
            pos_hint: {'x': 0, 'y': 0}
            font_size: 15

    FloatLayout:
        size_hint: 1, 0.15
        pos_hint: {'x': 0, 'y': 0.4}

        Label:
            size_hint: 0.2, 1
            pos_hint: {'x': 0.05, 'y': 0}
            text: '1:23'

        Label:
            size_hint: 0.2, 1
            pos_hint: {'right': 0.95, 'y': 0}
            text: '3:45'

        MusicProgressBar:
            id: progress_bar
            size_hint: 0.5, 1
            pos_hint: {'x': 0.25, 'y': 0}
            max: 1
            value: 0

    FloatLayout:
        size_hint: 1, 0.35
        pos_hint: {'x': 0, 'y': 0.05}

        ImageButton:
            id: play_btn
            source: 'static/music/play.png'
            size_hint: 0.5, 1
            pos_hint: {'x': 0.25, 'y': 0}
            on_press: self.parent.parent.on_play_press()

        ImageButton:
            id: prev_btn
            source: 'static/music/prev.png'
            size_hint: 0.25, 0.7
            pos_hint: {'x': 0.1, 'y': 0.15}

        ImageButton:
            id: next_btn
            source: 'static/music/next.png'
            size_hint: 0.25, 0.7
            pos_hint: {'x': 0.65, 'y': 0.15}


<CalendarPanel@Panel>:
    pos: panel_width+clearance_size, 0


<OneMorePanel@Panel>:
    pos: 0, 0


<Panels@RelativeLayout>:
    weather: weather
    music: music
    calendar: calendar

    size_hint: None, None
    size: panel_width*2+clearance_size , sidebar_height
    pos: sidebar_width + 37, (480 - sidebar_height) / 2

    weather: weather
    music: music
    calendar: calendar

    WeatherPanel:
        id: weather

    MusicPanel:
        id: music

    CalendarPanel:
        id: calendar

    OneMorePanel:
        id: one_more


<MainScreen>:
    sidebar: sidebar
    panels: panels

    RelativeLayout:
        size: self.parent.size
        pos: self.parent.pos

        canvas:
            Rectangle:
                source: 'static/background.png'
                size: self.size
                pos: self.pos

        Sidebar:
            id: sidebar

        Panels:
            id: panels

        TimeLabel:
            size_hint: 0.05, 0.05
            pos_hint: {'right': 0.985, 'y': 0.01}
            font_size: 20


<SettingsScreen>:
    update_btn: update_btn
    sensors_update_btn: sensors_update_btn

    FloatLayout:
        size: self.parent.size
        pos: self.parent.pos

        canvas:
            Color:
                rgb: 0, 0, 0
            Rectangle:
                pos: self.pos
                size: self.size

        Button:
            id: sensors_update_btn
            size_hint: 0.9, 0.15
            pos_hint: {'x':0.05, 'y':0.35}
            text: 'Update Sensors'

        Button:
            id: update_btn
            size_hint: 0.9, 0.15
            pos_hint: {'x':0.05, 'y':0.15}
            text: 'Update System'

        Button:
            text: 'Back'
            size_hint: 0.1, 0.1
            pos_hint: {'x':0, 'y':0}
            on_press:
                root.manager.transition.direction = 'right'
                root.manager.current = 'main'
