
<MusicProgressBar>:
    value: 0

    dot: dot

    canvas:
        Color:
            rgb: 1, 1, 1

        BorderImage:
            border: (12, 12, 12, 12)
            pos: self.x, self.center_y - 12
            size: self.width, 24
            source: 'atlas://data/images/defaulttheme/progressbar_background'
        BorderImage:
            border: [int(min(self.width * self.value_normalized, 12))] * 4
            pos: self.x, self.center_y - 12
            size: self.width * self.value_normalized, 24
            source: 'static/music/progressbar.png'

    Image:
        id: dot
        source: 'static/music/progress_bar_dot.png'
        size: 14, 14
        pos: self.parent.x - 7 + self.parent.value_normalized * self.parent.width, self.parent.y + self.parent.height / 2 - 7


<MusicVerticalProgressBar>:
    value: 0

    dot: dot

    canvas:
        Color:
            rgb: 1, 1, 1

        PushMatrix:
        Rotate:
            angle: 90
            origin: self.center

        BorderImage:
            border: (12, 12, 12, 12)
            pos: self.x - self.height/2 + 16, self.center_y - 12
            size: self.height, 24
            source: 'atlas://data/images/defaulttheme/progressbar_background'

        BorderImage:
            border: [int(min(self.width * self.value_normalized, 12))] * 4
            pos: self.x - self.height/2 + 16, self.center_y - 12
            size: self.height * self.value_normalized, 24
            source: 'static/music/progressbar.png'

        PopMatrix:

    Image:
        id: dot
        source: 'static/music/progress_bar_dot.png'
        size: 14, 14
        pos: self.parent.center_x - 7, self.parent.y - 7 + self.parent.value_normalized * self.parent.height


<MusicPanel@Panel+PlayerWidget>:
    pos: panel_width+clearance_size, panel_height+clearance_size

    play_btn: play_btn
    progress_bar: progress_bar
    current_time: current_time
    total_time: total_time
    artist: artist
    title: title
    volume: volume

    FloatLayout:
        size_hint: 1, 0.15
        pos_hint: {'x': 0, 'top': 0.95}

        ImageButton:
            source: 'static/music/shuffle.png'
            size_hint: 0.15, 1
            pos_hint: {'x': 0.2, 'y': 0}

        ImageButton:
            source: 'static/music/repeat.png'
            size_hint: 0.2, 1
            pos_hint: {'x': 0.05, 'y': 0}

        ImageButton:
            source: 'static/music/dropdown.png'
            size_hint: 0.2, 1
            pos_hint: {'x': 0.75, 'y': 0}

    FloatLayout:
        size_hint: 1, 0.25
        pos_hint: {'x': 0, 'top': 0.8}

        Label:
            id: title
            text: '--//--'
            size_hint: 1, 0.55
            pos_hint: {'x': 0, 'y': 0.45}
            font_size: 20

        Label:
            id: artist
            text: '--'
            size_hint: 1, 0.45
            pos_hint: {'x': 0, 'y': 0}
            font_size: 15

    FloatLayout:
        size_hint: 1, 0.15
        pos_hint: {'x': 0, 'y': 0.4}

        Label:
            id: current_time
            size_hint: 0.2, 1
            pos_hint: {'x': 0.05, 'y': 0}
            text: '0:00'

        Label:
            id: total_time
            size_hint: 0.2, 1
            pos_hint: {'right': 0.95, 'y': 0}
            text: '0:00'

        MusicProgressBar:
            id: progress_bar
            size_hint: 0.5, 1
            pos_hint: {'x': 0.25, 'y': 0}
            max: 1
            value: 0
            on_manual_change: self.parent.parent.audio_player.set_position(self.value)

    MusicVerticalProgressBar:
        id: volume
        max: 1
        value: 0.5
        size_hint: 0.08, 0.6
        pos_hint: {'x': 0.92, 'y': 0.2}
        on_manual_change: self.parent.audio_player.set_volume(self.value)

    FloatLayout:
        size_hint: 1, 0.35
        pos_hint: {'x': 0, 'y': 0.05}

        ImageButton:
            id: play_btn
            source: 'static/music/play.png'
            size_hint: 0.5, 1
            pos_hint: {'x': 0.25, 'y': 0}
            on_press: self.parent.parent.on_play_press()

        ImageButton:
            # Hack to pre-load the texture from file
            source: 'static/music/pause.png'
            size_hint: 0, 0
            pos: -1000, -1000

        ImageButton:
            id: prev_btn
            source: 'static/music/prev.png'
            size_hint: 0.25, 0.7
            pos_hint: {'x': 0.1, 'y': 0.15}
            on_press: self.parent.parent.audio_player.prev()

        ImageButton:
            id: next_btn
            source: 'static/music/next.png'
            size_hint: 0.25, 0.7
            pos_hint: {'x': 0.65, 'y': 0.15}
            on_press: self.parent.parent.audio_player.next()
